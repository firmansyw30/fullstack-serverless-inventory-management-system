openapi: 3.0.1

info:
  title: Inventory Management API
  description: Serverless Inventory API using Google API Gateway
  version: 1.0.0

# =====================================================
# GOOGLE API GATEWAY BACKENDS
# =====================================================
x-google-api-management:
  backends:
    getItemsBackend:
      address: ${get_items_url}
      pathTranslation: APPEND_PATH_TO_ADDRESS

    createItemBackend:
      address: ${create_item_url}
      pathTranslation: APPEND_PATH_TO_ADDRESS

    updateItemBackend:
      address: ${update_item_url}
      pathTranslation: APPEND_PATH_TO_ADDRESS

    deleteItemBackend:
      address: ${delete_item_url}
      pathTranslation: APPEND_PATH_TO_ADDRESS

    healthBackend:
      address: ${health_check_url}
      pathTranslation: APPEND_PATH_TO_ADDRESS

# =====================================================
# GLOBAL SECURITY
# =====================================================
security:
  - api_key: []

# =====================================================
# PATHS
# =====================================================
paths:

  # ========================
  # /items
  # ========================
  /items:

    # ---------- CORS ----------
    options:
      operationId: itemsCors
      security: []
      responses:
        "204":
          description: CORS OK
          headers:
            Access-Control-Allow-Origin:
              schema:
                type: string
              example: "*"
            Access-Control-Allow-Methods:
              schema:
                type: string
              example: "GET, POST, OPTIONS"
            Access-Control-Allow-Headers:
              schema:
                type: string
              example: "Content-Type, Authorization, x-api-key"
      x-google-backend: healthBackend


    # ---------- GET ----------
    get:
      operationId: getItems
      responses:
        "200":
          description: OK
      x-google-backend: getItemsBackend

    # ---------- POST ----------
    post:
      operationId: createItem
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/ItemInput"
      responses:
        "201":
          description: Created
      x-google-backend: createItemBackend

  # ========================
  # /items/{itemId}
  # ========================
  /items/{itemId}:
    parameters:
      - name: itemId
        in: path
        required: true
        schema:
          type: string

    # ---------- CORS ----------
    options:
      operationId: itemCors
      security: []
      responses:
        "204":
          description: CORS OK
          headers:
            Access-Control-Allow-Origin:
              schema:
                type: string
              example: "*"
            Access-Control-Allow-Methods:
              schema:
                type: string
              example: "PUT, DELETE, OPTIONS"
            Access-Control-Allow-Headers:
              schema:
                type: string
              example: "Content-Type, Authorization, x-api-key"
      x-google-backend: healthBackend


    # ---------- PUT ----------
    put:
      operationId: updateItem
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/ItemUpdate"
      responses:
        "200":
          description: Updated
      x-google-backend: updateItemBackend

    # ---------- DELETE ----------
    delete:
      operationId: deleteItem
      responses:
        "200":
          description: Deleted
      x-google-backend: deleteItemBackend

  # ========================
  # /health
  # ========================
  /health:

    options:
      operationId: healthCors
      security: []
      responses:
        "204":
          description: CORS OK
          headers:
            Access-Control-Allow-Origin:
              schema:
                type: string
              example: "*"
            Access-Control-Allow-Methods:
              schema:
                type: string
              example: "GET, OPTIONS"
            Access-Control-Allow-Headers:
              schema:
                type: string
              example: "Content-Type, Authorization, x-api-key"
      x-google-backend: healthBackend


    get:
      operationId: healthCheck
      responses:
        "200":
          description: Healthy
      x-google-backend: healthBackend

# =====================================================
# COMPONENTS
# =====================================================
components:
  securitySchemes:
    api_key:
      type: apiKey
      name: x-api-key
      in: header

  schemas:
    ItemInput:
      type: object
      required:
        - name
      properties:
        name:
          type: string
        price:
          type: number

    ItemUpdate:
      type: object
      properties:
        name:
          type: string
        price:
          type: number
